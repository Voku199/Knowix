<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Z√°bavn√© procviƒçov√°n√≠ angliƒçtiny pomoc√≠ p√≠sniƒçek, chatu a test≈Ø. Knowix je zdarma a bez reklam.">
    <meta name="keywords" content="angliƒçtina, procviƒçov√°n√≠, p√≠sniƒçky, testy, chat, v√Ωuka, zdarma, knowix, z√°bava, ≈°kola">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Knowix ‚Äì Procviƒçov√°n√≠ angliƒçtiny zdarma">
    <meta property="og:description" content="Procviƒçuj angliƒçtinu z√°bavnƒõ pomoc√≠ p√≠sniƒçek, chatu a test≈Ø. Bez reklam, zdarma.">
    <meta property="og:url" content="https://www.knowix.cz">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://knowix.cz/static/og-banner.png">
    <link rel="canonical" href="https://www.knowix.cz">
    <title>Knowix</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600&display=swap" rel="stylesheet"
          media="print" onload="this.media='all'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600&display=swap" rel="stylesheet">
    </noscript>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
            justify-content: center;
            margin: 30px auto;
            max-width: 900px;
        }
        .chart-container {
            width: 420px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 8px #0001;
            padding: 20px 10px 10px 10px;
            margin-bottom: 20px;
        }
        .date-label {
            font-family: monospace;
            font-weight: bold;
            color: #333;
            text-align: center;
            display: block;
            margin: 10px 0 0 0;
        }
        h1 {
            margin-top: 30px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body class="{{ 'dark-mode' if session.get('theme') == 'dark' else '' }}">
<header>
    <div class="logo-streak-wrapper">
        <div class="logo">
            <a href="{{ url_for('main.index') }}">
                <img src="{{ url_for('static', filename='pic/logo.webp') }}" alt="Knowix Logo">
            </a>
        </div>
        <span class="streak-badge">
            <img src="/static/fire.svg" alt="Streak">
            {{ user_streak }}
        </span>
    </div>
    <div class="nav-profile-wrapper">
        <ul class="nav-right">
            <li>
                <a href="/anglictina" title="Angliƒçtina">
                    <img src="{{ url_for('static', filename='icons/eng.png') }}" alt="Angliƒçtina" class="nav-icon">
                </a>
            </li>
            <li>
                <a href="/feedback" title="Feedback">
                    <img src="{{ url_for('static', filename='icons/chat.png') }}" alt="Feedback" class="nav-icon">
                </a>
            </li>
            <li>
                <a href="/news" title="Novinky">
                    <img src="{{ url_for('static', filename='icons/bell.png') }}" alt="Novinky" class="nav-icon">
                </a>
            </li>
            <li>
                <a href="/obchod" title="Obchod">
                    <img src="{{ url_for('static', filename='icons/shop.png') }}" alt="Obchod" class="nav-icon">
                </a>
            </li>
            <li>
                <a href="/zpravy" title="Zpr√°vy">
                    <img src="{{ url_for('static', filename='icons/mail.png') }}" alt="Zpr√°vy" class="nav-icon">
                </a>
            </li>
            <li>
                <button id="theme-toggle" title="P≈ôepnout t√©ma" style="background:none;border:none;cursor:pointer;padding:0;">
                    üåô
                </button>
            </li>
        </ul>
        {% if session['user_name'] %}
        <div class="user-profile">
            <div class="profile-container">
                {% if session.get('profile_pic') %}
                <img src="{{ url_for('static', filename='profile_pics/' + session['profile_pic']) }}"
                     alt="Profilov√° fotka" width="64" class="profile-pic">
                {% else %}
                <img src="{{ url_for('static', filename='pic/default.webp') }}" alt="Defaultn√≠ profilovka"
                     class="profile-pic" id="profileMenuTrigger">
                {% endif %}
                <div class="profile-menu" id="profileMenu">
                    <a href="{{ url_for('auth.settings') }}">‚öôÔ∏è Nastaven√≠</a>
                    <a href="{{ url_for('auth.logout') }}">üö™ Odhl√°sit se</a>
                </div>
                <span class="greeting" style="margin-left: 10px;">Ahoj {{ session['user_name'].split()[0] }}!</span>
            </div>
            {% if user_xp is defined and user_level is defined and user_level_name is defined and user_progress_percent is defined %}
            <div class="xp-header-bar">
                <div class="xp-header-bar-labels">
                    <span class="xp-level-badge">Level {{ user_level }} ‚Äì {{ user_level_name }}</span>
                    <span class="xp-value">{{ user_xp_in_level }}/50 XP</span>
                </div>
                <div class="xp-header-bar-progress-bg">
                    <div class="xp-header-bar-progress" style="width: {{ user_progress_percent }}%"></div>
                </div>
            </div>
            {% endif %}
        </div>
        {% else %}
<div class="auth-links">
    <a href="{{ url_for('auth.login') }}" class="auth-btn login-btn">üîë P≈ôihl√°sit se</a>
    <a href="{{ url_for('auth.register') }}" class="auth-btn register-btn">üìù Registrovat se</a>
</div>
        {% endif %}
    </div>
</header>
<h1>Moje statistiky</h1>

<div class="chart-grid">
    <!-- Odpovƒõdi -->
    <div class="chart-container">
        <canvas id="answersChart"></canvas>
    </div>
    <!-- Lekce, ƒças, psan√≠ -->
    <div class="chart-container">
        <canvas id="mainNumbersChart"></canvas>
    </div>
    <!-- Hangman & Irregular verbs -->
    <div class="chart-container">
        <canvas id="hangmanIrregularChart"></canvas>
    </div>
    <!-- P≈ôedp≈ô√≠tomn√Ω ƒças -->
    <div class="chart-container">
        <canvas id="ppChart"></canvas>
    </div>
    <!-- Roleplaying -->
    <div class="chart-container">
        <canvas id="roleplayingChart"></canvas>
    </div>
    <!-- Listening & AT -->
    <div class="chart-container">
        <canvas id="listeningAtChart"></canvas>
    </div>
</div>

<div style="text-align:center;">
    <span class="date-label">Prvn√≠ aktivita: <span id="first-activity"></span></span>
    <span class="date-label">Posledn√≠ aktivita: <span id="last-activity"></span></span>
</div>

<footer>
    <p>&copy; 2025 Knowix. V≈°echna pr√°va vyhrazena.</p>
    <p class="footer-signature">
        Made with ‚ù§Ô∏è by
        <a href="https://ko-fi.com/voku199" target="_blank" style="color: inherit; text-decoration: underline;">Voku</a>
        and lot of ‚òï
    </p>
</footer>

<script>

        // theme-toggle.js
    document.getElementById('theme-toggle').addEventListener('click', () => {
        fetch('/set_theme', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                theme: document.body.classList.contains('dark-mode') ? 'light' : 'dark'
            })
        }).then(() => {
            document.body.classList.toggle('dark-mode');
            sessionStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        });
    });
    // Data z backendu
    const correctRaw = {{ stats.correct_answers|default(0) }};
    const wrongRaw = {{ stats.wrong_answers|default(0) }};
    const lessons = {{ stats.total_lessons_done|default(0) }};
    const learningTimeRaw = {{ stats.total_learning_time|default(0) }};
    const psaniWords = {{ stats.total_psani_words|default(0) }};
    const hangmanWords = {{ stats.hangman_words_guessed|default(0) }};
    const irregularVerbsGuessed = {{ stats.irregular_verbs_guessed|default(0) }};
    const irregularVerbsWrong = {{ stats.irregular_verbs_wrong|default(0) }};
    const ppWrong = {{ stats.pp_wrong|default(0) }};
    const ppMaybe = {{ stats.pp_maybe|default(0) }};
    const ppCorrect = {{ stats.pp_correct|default(0) }};
    const roleplayingCr = {{ stats.roleplaying_cr|default(0) }};
    const roleplayingMb = {{ stats.roleplaying_mb|default(0) }};
    const roleplayingWr = {{ stats.roleplaying_wr|default(0) }};
    const lisCor = {{ stats.lis_cor|default(0) }};
    const lisWr = {{ stats.lis_wr|default(0) }};
    const atCor = {{ stats.at_cor|default(0) }};
    const atWr = {{ stats.at_wr|default(0) }};
    const firstActivityRaw = "{{ stats.first_activity or '' }}";
    const lastActiveRaw = "{{ stats.last_active or '' }}";

    // Spr√°vn√© a ≈°patn√© odpovƒõdi dƒõl√≠me dvƒõma
    const correct = Math.floor(correctRaw / 2);
    const wrong = Math.floor(wrongRaw / 2);

    function formatLearningTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        if (mins > 0) {
            return `${mins} min ${secs} s`;
        } else {
            return `${secs} s`;
        }
    }

    function formatDateTime(dt) {
        if (!dt || dt === "None") return "zat√≠m ≈æ√°dn√°";
        const match = dt.match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{2}):(\d{2})/);
        if (!match) return dt;
        const [, y, m, d, h, min] = match;
        return `${parseInt(d)}.${parseInt(m)} ${y} ${h}:${min}`;
    }
    document.getElementById('first-activity').textContent = formatDateTime(firstActivityRaw);
    document.getElementById('last-activity').textContent = formatDateTime(lastActiveRaw);

    document.addEventListener('DOMContentLoaded', function() {
        // 1. Pomƒõr spr√°vn√Ωch/≈°patn√Ωch odpovƒõd√≠
        new Chart(document.getElementById('answersChart'), {
            type: 'doughnut',
            data: {
                labels: ['Spr√°vn√©', '≈†patn√©'],
                datasets: [{
                    data: [correct, wrong],
                    backgroundColor: ['#4caf50', '#f44336'],
                    borderWidth: 0
                }]
            },
            options: {
                plugins: {
                    legend: { display: true, position: 'bottom' },
                    title: { display: true, text: 'Pomƒõr spr√°vn√Ωch a ≈°patn√Ωch odpovƒõd√≠', font: { size: 18 } }
                },
                cutout: '65%'
            }
        });

        // 2. Z√°kladn√≠ ƒç√≠sla (lekce, ƒças, psan√≠)
        new Chart(document.getElementById('mainNumbersChart'), {
            type: 'bar',
            data: {
                labels: ['Lekce', 'ƒåas uƒçen√≠ (min)', 'Slova v psan√≠'],
                datasets: [{
                    data: [lessons, Math.round(learningTimeRaw / 60), psaniWords],
                    backgroundColor: ['#2196f3', '#ff9800', '#9c27b0'],
                    borderRadius: 6
                }]
            },
            options: {
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Celkov√© hodnoty', font: { size: 18 } }
                },
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });

        // 3. Hangman & nepravideln√° slovesa
        new Chart(document.getElementById('hangmanIrregularChart'), {
            type: 'bar',
            data: {
                labels: ['Hangman', 'Nepravideln√° slovesa spr√°vnƒõ', 'Nepravideln√° slovesa ≈°patnƒõ'],
                datasets: [{
                    data: [hangmanWords, irregularVerbsGuessed, irregularVerbsWrong],
                    backgroundColor: ['#607d8b', '#8bc34a', '#e57373'],
                    borderRadius: 6
                }]
            },
            options: {
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Hangman & Nepravideln√° slovesa', font: { size: 18 } }
                },
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });

        // 4. P≈ôedp≈ô√≠tomn√Ω ƒças
        new Chart(document.getElementById('ppChart'), {
            type: 'bar',
            data: {
                labels: ['≈†patnƒõ', 'Mo≈æn√°', 'Spr√°vnƒõ'],
                datasets: [{
                    data: [ppWrong, ppMaybe, ppCorrect],
                    backgroundColor: ['#f44336', '#ffc107', '#4caf50'],
                    borderRadius: 6
                }]
            },
            options: {
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'P≈ôedp≈ô√≠tomn√Ω ƒças', font: { size: 18 } }
                },
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });

        // 5. Roleplaying
        new Chart(document.getElementById('roleplayingChart'), {
            type: 'bar',
            data: {
                labels: ['Spr√°vnƒõ', 'Mo≈æn√°', '≈†patnƒõ'],
                datasets: [{
                    data: [roleplayingCr, roleplayingMb, roleplayingWr],
                    backgroundColor: ['#00bcd4', '#ff9800', '#9c27b0'],
                    borderRadius: 6
                }]
            },
            options: {
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Roleplaying', font: { size: 18 } }
                },
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });

        // 6. Listening & AT
        new Chart(document.getElementById('listeningAtChart'), {
            type: 'bar',
            data: {
                labels: ['Listening spr√°vnƒõ', 'Listening ≈°patnƒõ', 'At on in, spr√°vnƒõ', 'At on in, ≈°patnƒõ'],
                datasets: [{
                    data: [lisCor, lisWr, atCor, atWr],
                    backgroundColor: ['#4caf50', '#f44336', '#2196f3', '#e57373'],
                    borderRadius: 6
                }]
            },
            options: {
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'Listening & At on in', font: { size: 18 } }
                },
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });
    });
</script>
</body>
</html>