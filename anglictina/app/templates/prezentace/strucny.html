<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Stručný obsah | Maycomb</title>
    <link rel="stylesheet" href="../../static/prezentace/style.css"/>
</head>
<body>
<button class="back-btn" aria-label="Vrátit se zpět" onclick="return false;">← Zpět</button>

<!-- Pixel PowerPoint Container -->
<div class="powerpoint-container" id="powerpointContainer">
    <!-- Slide Navigation -->
    <div class="slide-nav">
        <button class="nav-btn prev-btn" id="prevBtn" aria-label="Předchozí slide">‹</button>
        <div class="slide-counter">
            <span class="current-slide" id="currentSlide">1</span>
            <span class="slide-separator">/</span>
            <span class="total-slides" id="totalSlides">6</span>
        </div>
        <button class="nav-btn next-btn" id="nextBtn" aria-label="Další slide">›</button>
    </div>

    <!-- Slides Container -->
    <div class="slides-wrapper" id="slidesWrapper">

        <!-- Slide 1: Úvod -->
        <div class="slide active" data-slide="1">
            <div class="slide-content title-slide">
                <div class="pixel-icon">
                    <div class="icon-bird">
                        <div class="bird-body"></div>
                        <div class="bird-wing"></div>
                        <div class="bird-eye"></div>
                    </div>
                </div>
                <h1 class="slide-title">Stručný <span class="accent">obsah</span></h1>
                <h2 class="slide-subtitle">Krátké shrnutí děje knihy</h2>
            </div>
        </div>

        <!-- Slide 2: Začátek -->
        <div class="slide" data-slide="2">
            <div class="slide-content">
                <h1 class="slide-title">Začátek</h1>
                <div class="bullet-points">
                    <div class="bullet-point" data-reveal="1">
                        <span class="bullet">»</span>
                        <span class="text">Seznámení se Scout, Jemem a Atticem.</span>
                    </div>
                    <div class="bullet-point" data-reveal="2">
                        <span class="bullet">»</span>
                        <span class="text">Život v Maycombu, první náznaky konfliktů ve městě.</span>
                    </div>
                    <div class="bullet-point" data-reveal="3">
                        <span class="bullet">»</span>
                        <span class="text">Děti žijí s otcem Atticem, který je právník.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 3: Střed -->
        <div class="slide" data-slide="3">
            <div class="slide-content">
                <h1 class="slide-title">Střed</h1>
                <div class="bullet-points">
                    <div class="bullet-point" data-reveal="1">
                        <span class="bullet">»</span>
                        <span class="text">Atticus obhajuje obviněného černocha.</span>
                    </div>
                    <div class="bullet-point" data-reveal="2">
                        <span class="bullet">»</span>
                        <span class="text">Děti se učí, co je správné a co špatné.</span>
                    </div>
                    <div class="bullet-point" data-reveal="3">
                        <span class="bullet">»</span>
                        <span class="text">Odhalují se příběhy a tajemství města.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 4: Závěr -->
        <div class="slide" data-slide="4">
            <div class="slide-content">
                <h1 class="slide-title">Závěr</h1>
                <div class="bullet-points">
                    <div class="bullet-point" data-reveal="1">
                        <span class="bullet">»</span>
                        <span class="text">Odhalení, reflexe a ponaučení pro děti.</span>
                    </div>
                    <div class="bullet-point" data-reveal="2">
                        <span class="bullet">»</span>
                        <span class="text">Děti si lépe uvědomují svět dospělých.</span>
                    </div>
                    <div class="bullet-point" data-reveal="3">
                        <span class="bullet">»</span>
                        <span class="text">Konec zdůrazňuje odvahu, morálku a spravedlnost.</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 5: MINI KVÍZ – úvod -->
        <div class="slide" data-slide="5">
            <div class="slide-content quiz-intro">
                <h1 class="slide-title">MINI KVÍZ</h1>
                <div class="quiz-intro-text">
                    <p>Otestuj si, jestli rozumíš shrnutí děje.</p>
                    <div class="quiz-stats">
                        <div class="stat-item">
                            <span class="stat-number">3</span>
                            <span class="stat-label">OTÁZKY</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">3</span>
                            <span class="stat-label">MOŽNOSTI</span>
                        </div>
                    </div>
                </div>
                <button class="start-quiz-btn" id="startQuizBtn">ZAČÍT KVÍZ</button>
            </div>
        </div>

        <!-- Slide 6: MINI KVÍZ – obsah -->
        <div class="slide" data-slide="6">
            <div class="slide-content quiz-content">
                <div class="quiz-header">
                    <div class="quiz-progress">
                        <span class="progress-text">OTÁZKA <span id="questionNumber">1</span> Z 3</span>
                        <div class="progress-bar-quiz">
                            <div class="progress-fill-quiz" id="progressFillQuiz"></div>
                        </div>
                    </div>
                    <div class="quiz-score">SKÓRE: <span id="quizScore">0</span>/3</div>
                </div>

                <div class="quiz-question">
                    <h2 class="question-text" id="questionText">…</h2>
                </div>

                <div class="quiz-answers" id="quizAnswers"></div>

                <div class="quiz-feedback" id="quizFeedback" style="display: none;">
                    <div class="feedback-text"></div>
                    <button class="next-question-btn" id="nextQuestionBtn">DALŠÍ OTÁZKA</button>
                </div>

                <div class="quiz-result" id="quizResult" style="display: none;">
                    <h2 class="result-title">VÝSLEDEK KVÍZU</h2>
                    <div class="result-score" id="finalScore">0/3</div>
                    <div class="result-message" id="resultMessage">Skvělé!</div>
                    <div class="result-actions">
                        <button class="restart-quiz-btn" id="restartQuizBtn">ZKUSIT ZNOVU</button>
                        <button class="back-to-map-btn" id="backToMapBtnQuiz">ZPĚT NA MAPU</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Slide indicators -->
    <div class="slide-indicators" id="slideIndicators">
        <span class="indicator active" data-slide="1"></span>
        <span class="indicator" data-slide="2"></span>
        <span class="indicator" data-slide="3"></span>
        <span class="indicator" data-slide="4"></span>
        <span class="indicator" data-slide="5"></span>
        <span class="indicator" data-slide="6"></span>
    </div>
</div>

<!-- Loading overlay markup -->
<div class="loading-overlay" id="loading" aria-hidden="true">
    <div class="stars" id="stars"></div>
    <div class="loading-container">
        <div class="loading-icon">
            <div class="pixel-building">
                <div class="building-base"></div>
                <div class="building-roof"></div>
                <div class="building-windows">
                    <div class="window"></div>
                    <div class="window"></div>
                    <div class="window"></div>
                    <div class="window"></div>
                </div>
            </div>
        </div>
        <div class="loading-label">PŘESUN NA MAPU...</div>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
                <div class="progress-blocks">
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                    <div class="block"></div>
                </div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
        </div>
        <div class="loading-phases" id="loadingPhases">
            <div class="phase active">» Připravujeme návrat...</div>
            <div class="phase">» Ukládání informací...</div>
            <div class="phase">» Příprava mapy Maycombu...</div>
            <div class="phase">» Tvoření hvězdné cesty...</div>
            <div class="phase">» Přistání na mapě...</div>
        </div>
    </div>
</div>

<script>
    (function () {
        let currentSlide = 1;
        const totalSlides = 6;

        // Quiz state
        let quizStarted = false;
        let currentQuestion = 0;
        let quizScore = 0;
        const quizQuestions = [
            {
                question: "Kdo je Atticus ve vztahu ke Scout a Jemovi?",
                answers: ["A) Strýc", "B) Otec a právník", "C) Učitel"],
                correct: "B",
                feedback: "Atticus je jejich otec a zároveň právník."
            },
            {
                question: "Co se děje ve středu příběhu?",
                answers: [
                    "A) Atticus hájí obviněného u soudu",
                    "B) Děti se přestěhují do jiného města",
                    "C) Kniha se mění na sci-fi příběh"
                ],
                correct: "A",
                feedback: "Hlavní část se točí kolem soudního procesu."
            },
            {
                question: "Jaké hlavní hodnoty zdůrazňuje závěr příběhu?",
                answers: ["A) Bohatství a slávu", "B) Odvahu, morálku a spravedlnost", "C) Soutěživost"],
                correct: "B",
                feedback: "Závěr zdůrazňuje odvahu, morálku a spravedlnost."
            }
        ];

        // Loading overlay elements
        const overlay = document.getElementById('loading');
        const stars = document.getElementById('stars');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const loadingPhases = document.getElementById('loadingPhases');
        const LOAD_DELAY = 3000;

        function buildStars() {
            if (!stars) return;
            stars.innerHTML = '';
            const w = window.innerWidth, h = window.innerHeight;
            const area = w * h;
            const count = Math.min(240, Math.max(40, Math.round(area / 12000)));
            for (let i = 0; i < count; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                const x = Math.random() * w, y = Math.random() * h;
                const delay = Math.round(Math.random() * 900) + 'ms';
                s.style.left = x + 'px';
                s.style.top = y + 'px';
                s.style.animationDelay = delay;
                stars.appendChild(s);
            }
        }

        function animateLoading() {
            if (!loadingPhases) return;
            const phases = loadingPhases.querySelectorAll('.phase');
            let currentPhase = 0;
            let progress = 0;

            const interval = setInterval(() => {
                progress += 2;
                if (progressFill) progressFill.style.width = Math.min(progress, 100) + '%';
                if (progressText) progressText.textContent = Math.min(progress, 100) + '%';

                const phaseProgress = Math.floor(progress / 20);
                if (phaseProgress > currentPhase && phaseProgress < phases.length) {
                    phases[currentPhase].classList.remove('active');
                    phases[phaseProgress].classList.add('active');
                    currentPhase = phaseProgress;
                }

                if (progress >= 100) {
                    clearInterval(interval);
                    phases[currentPhase]?.classList.remove('active');
                    const completionPhase = document.createElement('div');
                    completionPhase.className = 'phase active completion';
                    completionPhase.textContent = '» Připraveno!';
                    loadingPhases.appendChild(completionPhase);
                }
            }, LOAD_DELAY / 50);
        }

        function backToMap() {
            if (overlay) {
                buildStars();
                overlay.classList.add('show');
                animateLoading();
                setTimeout(() => {
                    window.location.href = 'prezentacer_main.html';
                }, LOAD_DELAY);
            } else {
                window.location.href = 'prezentacer_main.html';
            }
        }

        function setupEventListeners() {
            document.getElementById('prevBtn').addEventListener('click', () => changeSlide(-1));
            document.getElementById('nextBtn').addEventListener('click', () => changeSlide(1));
            const backBtn = document.querySelector('.back-btn');
            if (backBtn) backBtn.addEventListener('click', (e) => {
                e.preventDefault();
                backToMap();
            });

            // Quiz listeners (guarded by existence)
            const startBtn = document.getElementById('startQuizBtn');
            startBtn && startBtn.addEventListener('click', startQuiz);
            const nextQ = document.getElementById('nextQuestionBtn');
            nextQ && nextQ.addEventListener('click', nextQuestion);
            const restartBtn = document.getElementById('restartQuizBtn');
            restartBtn && restartBtn.addEventListener('click', restartQuiz);
            const backQuizBtn = document.getElementById('backToMapBtnQuiz');
            backQuizBtn && backQuizBtn.addEventListener('click', backToMap);

            // Answer buttons (event delegation)
            document.addEventListener('click', (e) => {
                if (e.target.classList && e.target.classList.contains('answer-btn') && quizStarted) {
                    selectAnswer(e.target);
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') changeSlide(-1);
                if (e.key === 'ArrowRight') changeSlide(1);
                if (e.key === 'Escape') backToMap();
            });

            // Slide indicators
            document.querySelectorAll('.indicator').forEach(indicator => {
                indicator.addEventListener('click', (e) => {
                    const targetSlide = parseInt(e.target.dataset.slide);
                    goToSlide(targetSlide);
                });
            });

            window.addEventListener('resize', () => {
                if (overlay && overlay.classList.contains('show')) buildStars();
            });
        }

        function changeSlide(direction) {
            const newSlide = currentSlide + direction;
            if (newSlide >= 1 && newSlide <= totalSlides) {
                goToSlide(newSlide);
            }
        }

        function goToSlide(slideNumber) {
            currentSlide = slideNumber;
            updateSlideDisplay();
            setTimeout(() => {
                revealBulletPoints();
            }, 200);
        }

        function updateSlideDisplay() {
            document.querySelectorAll('.slide').forEach(slide => {
                slide.classList.remove('active');
            });
            const currentSlideEl = document.querySelector(`.slide[data-slide="${currentSlide}"]`);
            if (currentSlideEl) currentSlideEl.classList.add('active');
            document.getElementById('currentSlide').textContent = currentSlide;
            document.getElementById('prevBtn').disabled = currentSlide === 1;
            document.getElementById('nextBtn').disabled = currentSlide === totalSlides;
            document.querySelectorAll('.indicator').forEach((indicator, index) => {
                indicator.classList.toggle('active', index + 1 === currentSlide);
            });
        }

        function revealBulletPoints() {
            const currentSlideEl = document.querySelector(`.slide[data-slide="${currentSlide}"]`);
            if (!currentSlideEl) return;
            const bulletPoints = currentSlideEl.querySelectorAll('[data-reveal]');
            if (bulletPoints.length > 0) {
                bulletPoints.forEach((bullet, index) => {
                    setTimeout(() => {
                        bullet.classList.add('revealed');
                    }, index * 300);
                });
            }
        }

        // Quiz functions
        function startQuiz() {
            quizStarted = true;
            quizScore = 0;
            currentQuestion = 0;
            goToSlide(6);
            setTimeout(showQuestion, 250);
        }

        function showQuestion() {
            const q = quizQuestions[currentQuestion];
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('quizScore').textContent = quizScore;
            const progress = (currentQuestion / quizQuestions.length) * 100;
            document.getElementById('progressFillQuiz').style.width = progress + '%';
            const answersContainer = document.getElementById('quizAnswers');
            answersContainer.innerHTML = '';
            q.answers.forEach(a => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.dataset.answer = a.charAt(0);
                btn.textContent = a;
                answersContainer.appendChild(btn);
            });
            document.getElementById('quizFeedback').style.display = 'none';
            document.getElementById('quizResult').style.display = 'none';
            answersContainer.style.display = 'block';
        }

        function selectAnswer(btn) {
            const selected = btn.dataset.answer;
            const correct = quizQuestions[currentQuestion].correct;
            document.querySelectorAll('.answer-btn').forEach(b => {
                b.disabled = true;
                b.classList.remove('correct', 'incorrect');
            });
            if (selected === correct) {
                btn.classList.add('correct');
                quizScore++;
            } else {
                btn.classList.add('incorrect');
                const correctBtn = document.querySelector(`.answer-btn[data-answer="${correct}"]`);
                correctBtn && correctBtn.classList.add('correct');
            }
            document.getElementById('quizScore').textContent = quizScore;
            setTimeout(() => {
                const feedback = document.getElementById('quizFeedback');
                feedback.querySelector('.feedback-text').textContent = quizQuestions[currentQuestion].feedback;
                feedback.style.display = 'block';
                document.getElementById('quizAnswers').style.display = 'none';
            }, 800);
        }

        function nextQuestion() {
            currentQuestion++;
            if (currentQuestion < quizQuestions.length) {
                showQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            const resultScore = document.getElementById('finalScore');
            const resultMessage = document.getElementById('resultMessage');
            resultScore.textContent = `${quizScore}/${quizQuestions.length}`;
            let msg = '';
            if (quizScore === quizQuestions.length) msg = 'Perfektní! Shrnutí máš v malíčku. 🏆';
            else if (quizScore >= 2) msg = 'Výborně! Jen drobná nepřesnost. ⭐';
            else msg = 'Zkuste se vrátit k přehledu a projít si klíčové body. 📚';
            resultMessage.textContent = msg;
            document.getElementById('progressFillQuiz').style.width = '100%';
            document.getElementById('quizFeedback').style.display = 'none';
            document.getElementById('quizResult').style.display = 'block';
        }

        function restartQuiz() {
            quizStarted = false;
            quizScore = 0;
            currentQuestion = 0;
            goToSlide(5);
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('totalSlides').textContent = totalSlides;
            updateSlideDisplay();
            setupEventListeners();
            setTimeout(() => revealBulletPoints(), 200);
        });
    })();
</script>

<style>
    /* Prezentace používá globální style.css */
</style>

</body>
</html>