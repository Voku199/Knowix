{% extends "base.html" %}
{% block content %}

<style>
    /* --- STREAK TOAST --- */
    .streak-toast {
        position: fixed;
        top: 80px;
        right: 30px;
        background: #fffbe6;
        color: #d35400;
        border: 2px solid #ffc107;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
        padding: 1em 2em;
        font-size: 1.3em;
        display: flex;
        align-items: center;
        z-index: 3000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.4s, transform 0.4s;
        transform: translateY(-30px);
    }

    .streak-toast.active {
        opacity: 1;
        pointer-events: all;
        transform: translateY(0);
    }

    .streak-fire {
        height: 2em;
        margin-right: 0.7em;
        animation: firePop 0.7s cubic-bezier(.68, -0.55, .27, 1.55);
    }

    @keyframes firePop {
        0% {
            transform: scale(0.7) rotate(-10deg);
        }
        60% {
            transform: scale(1.2) rotate(10deg);
        }
        100% {
            transform: scale(1) rotate(0);
        }
    }
</style>


<main>
    <div class="phone-wrapper">
        <div class="top-notch"></div>
        <h2>Present Perfect Chat</h2>
        <div id="chat-window">
            <!-- Zprávy -->
        </div>
        <form id="answer-form">
            <input type="text" id="answer" autocomplete="off" placeholder="Přelož českou vetu do angličtiny..."
                   required/>
            <button id="submit-btn" type="submit">Odeslat</button>
        </form>
        <div id="feedback"></div>
        <div id="end-of-chat"></div>
    </div>
</main>

<!-- STREAK TOAST -->
<div id="streakToast" class="streak-toast" style="display:none;">
    <img src="/static/fire.svg" alt="Streak" class="streak-fire">
    <span id="streakToastText"></span>
</div>


<script src="{{ url_for('static', filename='gram/present_perfect/js/chat.js') }}"></script>
<script>
    // --- STREAK TOAST FUNKCE ---
    function showStreakToast(streak) {
        const toast = document.getElementById('streakToast');
        const text = document.getElementById('streakToastText');
        text.textContent = `🔥 Máš streak ${streak} dní v řadě!`;
        toast.classList.add('active');
        toast.style.display = 'flex';
        setTimeout(() => {
            toast.classList.remove('active');
            setTimeout(() => {
                toast.style.display = 'none';
            }, 400);
        }, 3500);
    }

    // --- Integrace do chat.js ---
    // V chat.js, po úspěšném dokončení lekce (když přijde odpověď s streak_info.status === "started" nebo "continued"):
    // if (data.streak_info && (data.streak_info.status === "started" || data.streak_info.status === "continued")) {
    //     showStreakToast(data.streak_info.streak);
    // }
</script>
{% endblock %}