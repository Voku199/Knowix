{% extends "base.html" %}
{% block content %}
<style>
    /* --- STREAK TOAST --- */
    .streak-toast {
        position: fixed;
        top: 80px;
        right: 30px;
        background: #fffbe6;
        color: #d35400;
        border: 2px solid #ffc107;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.12);
        padding: 1em 2em;
        font-size: 1.3em;
        display: flex;
        align-items: center;
        z-index: 3000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.4s, transform 0.4s;
        transform: translateY(-30px);
    }

    .streak-toast.active {
        opacity: 1;
        pointer-events: all;
        transform: translateY(0);
    }

    .streak-fire {
        height: 2em;
        margin-right: 0.7em;
        animation: firePop 0.7s cubic-bezier(.68, -0.55, .27, 1.55);
    }

    @keyframes firePop {
        0% {
            transform: scale(0.7) rotate(-10deg);
        }
        60% {
            transform: scale(1.2) rotate(10deg);
        }
        100% {
            transform: scale(1) rotate(0);
        }
    }
</style>

<div class="hangman-container">
    <h2>Hangman</h2>

    <div class="game-info">
        <span id="level">Úroveň: B2</span>
        <span id="hint">Nápověda: The end of something, usually logical.</span>
        <button id="showHintCzBtn" class="modern-btn">Ukázat českou nápovědu 🇨🇿</button>
        <div id="hintCz" style="margin-top: 10px; font-weight: bold;"></div>
    </div>

    <div id="hangmanDrawing"></div>
    <div id="maskedWord">_ _ _ _ _</div>
    <div id="letterButtons" class="alphabet"></div>

    <div class="game-stats">
        <p>Zbývá pokusů: <strong id="remainingAttempts">6</strong></p>
        <p>Uhodnutá písmena: <span id="guessedLetters">-</span></p>
    </div>

    <div id="resultMessage"></div>
    <button id="nextWordBtn" class="modern-btn">Další slovo →</button>
</div>

<!-- STREAK TOAST -->
<div id="streakToast" class="streak-toast" style="display:none;">
    <img src="/static/fire.svg" alt="Streak" class="streak-fire">
    <span id="streakToastText"></span>
</div>


<script>
    // theme-toggle.js
    document.getElementById('theme-toggle').addEventListener('click', () => {
        fetch('/set_theme', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                theme: document.body.classList.contains('dark-mode') ? 'light' : 'dark'
            })
        }).then(() => {
            document.body.classList.toggle('dark-mode');
            sessionStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        });
    });

    // Detekce kliknutí mimo menu
    document.addEventListener('click', (e) => {
        const profileMenu = document.getElementById('profileMenu');
        const trigger = document.getElementById('profileMenuTrigger');
        if (profileMenu && trigger && !trigger.contains(e.target) && !profileMenu.contains(e.target)) {
            profileMenu.style.opacity = '0';
            profileMenu.style.visibility = 'hidden';
            profileMenu.style.transform = 'translateY(10px)';
        }
    });

    // --- STREAK TOAST FUNKCE ---
    function showStreakToast(streak) {
        const toast = document.getElementById('streakToast');
        const text = document.getElementById('streakToastText');
        text.textContent = `🔥 Máš streak ${streak} dní v řadě!`;
        toast.classList.add('active');
        toast.style.display = 'flex';
        setTimeout(() => {
            toast.classList.remove('active');
            setTimeout(() => {
                toast.style.display = 'none';
            }, 400);
        }, 3500);
    }

    // --- Integrace streak toastu do Hangmanu ---
    // Předpokládáme, že hangman.js volá /hangman/guess a zpracovává odpověď
    // Pokud odpověď obsahuje streak_info se status "started" nebo "continued", zobrazíme toast

    // Tento kód můžeš vložit do hangman.js po zpracování odpovědi z guess
    // Pokud chceš, můžeš ho dát i sem, pokud odpověď z guess zpracováváš zde

    // Příklad: Pokud používáš fetch v hangman.js, přidej tam:
    /*
    if (data.streak_info && (data.streak_info.status === "started" || data.streak_info.status === "continued")) {
        showStreakToast(data.streak_info.streak);
    }
    */
</script>
{% endblock %}