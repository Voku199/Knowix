{% extends "base.html" %}
{% block content %}
    <style>

        body.dark-mode {
            background: #181c23;
        }
        main {
            max-width: 540px;
            margin: 2.5rem auto 1.5rem auto;
            background: rgba(255,255,255,0.97);
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.10);
            padding: 2.2rem 1.5rem 2rem 1.5rem;
            position: relative;
            animation: fadeIn 0.7s;
        }
        body.dark-mode main {
            background: #232b36;
            box-shadow: 0 8px 32px rgba(0,0,0,0.32);
        }
        input[type="text"], select {
            background: #f6fafd;
            border: 1.5px solid #b3c6e0;
            border-radius: 7px;
            padding: 0.7em;
            font-size: 1.08em;
            margin-bottom: 1em;
            color: #222;
        }
        body.dark-mode input[type="text"], body.dark-mode select {
            background: #000000;
            color: #fff;
            border: 1.5px solid #38405a;
        }
        button, .nav-btn {
            background: #1976d2;
            color: #fff;
            border: none;
            border-radius: 7px;
            padding: 0.7em 1.4em;
            font-size: 1.08em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        body.dark-mode button, body.dark-mode .nav-btn {
            background: #000000;
            color: #b2ff59;
        }
        button:hover, .nav-btn:hover {
            background: #1256a0;
        }
        body.dark-mode button:hover, body.dark-mode .nav-btn:hover {
            background: #232b36;
        }
        .streak-toast {
            position: fixed;
            top: 80px;
            right: 30px;
            background: #fffbe6;
            color: #d35400;
            border: 2px solid #ffc107;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.12);
            padding: 1em 2em;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s, transform 0.4s;
            transform: translateY(-30px);
        }
        body.dark-mode .streak-toast {
            background: #232b36;
            color: #ffe082;
            border: 2px solid #b2ff59;
        }
        .streak-fire {
            height: 2em;
            margin-right: 0.7em;
            animation: firePop 0.7s cubic-bezier(.68,-0.55,.27,1.55);
        }
        @keyframes firePop {
            0% { transform: scale(0.7) rotate(-10deg);}
            60% { transform: scale(1.2) rotate(10deg);}
            100% { transform: scale(1) rotate(0);}
        }
        h1 {
            text-align: center;
            font-size: 2.1rem;
            margin-bottom: 0.7rem;
            letter-spacing: 0.5px;
        }
        h2 {
            text-align: center;
            font-size: 1.3rem;
            color: #3498db;
            margin-bottom: 1.2rem;
            font-weight: 600;
        }
        .sentence {
            font-size: 1.25rem;
            margin: 18px 0 25px 0;
            padding: 18px 15px;
            background: #f6fafd;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(52,152,219,0.06);
            text-align: center;
            font-weight: 500;
            letter-spacing: 0.2px;
        }
        body.dark-mode .sentence {
            background: #1b222b;
            color: #fff;
            box-shadow: 0 2px 10px rgba(52,152,219,0.18);
        }
        .answer-buttons {
            display: flex;
            gap: 18px;
            margin: 25px 0 10px 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        .answer-btn {
            padding: 13px 24px;
            background: #f0f4fa;
            border: 2px solid #3498db;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.13rem;
            color: #3498db;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(52,152,219,0.07);
            outline: none;
        }
        .answer-btn:hover, .answer-btn:focus {
            background: #3498db;
            color: #fff;
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 6px 18px rgba(52,152,219,0.13);
        }
        .answer-btn.selected {
            background: #d1eaff;
            border-color: #217dbb;
            color: #217dbb;
        }
        .answer-btn.correct {
            background: #eaffea;
            border-color: #28a745;
            color: #28a745;
            font-weight: bold;
            animation: popIn 0.3s;
        }
        .answer-btn.incorrect {
            background: #ffeaea;
            border-color: #dc3545;
            color: #dc3545;
            font-weight: bold;
            animation: shake 0.4s;
        }
        .feedback-message {
            text-align: center;
            margin: 12px 0 0 0;
            font-size: 1.18rem;
            font-weight: 600;
        }
        .feedback-message.correct {
            color: #28a745;
        }
        .feedback-message.incorrect {
            color: #dc3545;
        }
        .progress-container {
            margin: 18px auto 18px auto;
            width: 90%;
            background-color: #eaf1fa;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(52,152,219,0.07);
            height: 22px;
            position: relative;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3498db 70%, #217dbb 100%);
            transition: width 0.5s cubic-bezier(.4,0,.2,1);
        }
        .progress-text {
            position: absolute;
            width: 100%;
            left: 0; top: 0;
            text-align: center;
            font-size: 1rem;
            color: #217dbb;
            font-weight: 600;
            line-height: 22px;
            letter-spacing: 0.2px;
            text-shadow: 0 1px 2px #fff;
        }
        .completion-message {
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 24px 18px;
            background: #f6fafd;
            border-radius: 14px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 2px 10px rgba(52,152,219,0.07);
        }
        .completion-message p {
            font-size: 1.25rem;
            margin-bottom: 1.2rem;
        }
        .completion-options {
            display: flex;
            gap: 18px;
            justify-content: center;
            margin-top: 18px;
        }
        .completion-btn, .nav-btn {
            padding: 13px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.13rem;
            font-weight: 600;
            transition: all 0.2s;
            background: #3498db;
            color: #fff;
            box-shadow: 0 2px 8px rgba(52,152,219,0.07);
        }
        .completion-btn:hover, .nav-btn:hover {
            background: #217dbb;
            color: #fff;
            transform: translateY(-2px) scale(1.04);
        }
        .continue-btn {
            background: #28a745;
            color: #fff;
            border-radius: 10px;
            padding: 13px 28px;
            font-size: 1.13rem;
            font-weight: 600;
            margin: 0 auto;
            display: block;
            margin-top: 1.5rem;
            transition: background 0.2s;
        }
        .continue-btn:hover {
            background: #1e7e34;
        }
        @media (max-width: 600px) {
            main {
                padding: 1.2rem 0.3rem 1.2rem 0.3rem;
            }
            .sentence {
                font-size: 1.07rem;
                padding: 12px 6px;
            }
            .answer-btn, .completion-btn, .nav-btn, .continue-btn {
                font-size: 1rem;
                padding: 10px 12px;
            }
        }
        @keyframes popIn {
            0% { transform: scale(0.8);}
            80% { transform: scale(1.08);}
            100% { transform: scale(1);}
        }
        @keyframes shake {
            0% { transform: translateX(0);}
            25% { transform: translateX(5px);}
            50% { transform: translateX(-5px);}
            75% { transform: translateX(5px);}
            100% { transform: translateX(0);}
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px);}
            to { opacity: 1; transform: translateY(0);}
        }
    </style>


<main>
    <h1>Dopl≈àte chybƒõj√≠c√≠ tvar</h1>
    <h2>Sloveso: {{ verb }}</h2>

    {% if verbs_done is defined and total_verbs is defined %}
    <div class="progress-container">
        <div class="progress-bar" style="width: {{ (progress_for_verb/6*100)|round(0, 'floor') }}%"></div>
        <div class="progress-text">
            Progres: {{ progress_for_verb }}/6 spr√°vn√Ωch odpovƒõd√≠
        </div>
    </div>
    {% endif %}

    {% if feedback and not lesson_complete %}
    <div class="feedback-message {% if is_correct %}correct{% else %}incorrect{% endif %}">
        {{ feedback }}
    </div>
    {% endif %}

{% if lesson_complete %}
<div class="completion-message fade-in">
    <p>Lekce dokonƒçena! üéâ</p>
    <div class="completion-options">
        <form method="POST" action="{{ url_for('verbs.test') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" name="new_lesson" value="1" class="nav-btn">üîÑ Nov√© sloveso</button>
            <input type="hidden" name="verb" value="{{ verb }}">
            <button type="submit" name="continue" value="1" class="completion-btn">Pokraƒçovat</button>
        </form>
    </div>
</div>
    {% elif sentence %}
    <div class="sentence">{{ sentence }}</div>
    <form method="POST" action="{{ url_for('verbs.test') }}" class="answer-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="answer-buttons">
            {% for answer in possible_answers %}
            <button type="submit"
                    name="user_answer"
                    value="{{ answer }}"
                    class="answer-btn">
                {{ answer }}
            </button>
            {% endfor %}
        </div>
    </form>
    {% else %}
    <form method="POST" action="{{ url_for('verbs.test') }}" class="next-sentence-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="verb" value="{{ verb }}">
        <button type="submit" name="continue" value="1" class="continue-btn">Pokraƒçovat</button>
    </form>
    {% endif %}
</main>


<script>
        // T√©ma
    const themeToggle = document.getElementById('theme-toggle');
    themeToggle.addEventListener('click', () => {
        document.body.classList.toggle('dark-mode');
    });

    // Detekce kliknut√≠ mimo menu
    document.addEventListener('click', (e) => {
        const profileMenu = document.getElementById('profileMenu');
        const trigger = document.getElementById('profileMenuTrigger');
        if (trigger && profileMenu && !trigger.contains(e.target) && !profileMenu.contains(e.target)) {
            profileMenu.style.opacity = '0';
            profileMenu.style.visibility = 'hidden';
            profileMenu.style.transform = 'translateY(10px)';
        }
    });

    function showStreakToast(streak) {
        const toast = document.getElementById('streakToast');
        const text = document.getElementById('streakToastText');
        text.textContent = `üî• M√°≈° streak ${streak} dn√≠ v ≈ôadƒõ!`;
        toast.classList.add('active');
        toast.style.display = 'flex';
        setTimeout(() => {
            toast.classList.remove('active');
            setTimeout(() => { toast.style.display = 'none'; }, 400);
        }, 3500);
    }
    document.addEventListener('DOMContentLoaded', function() {
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% for category, message in messages %}
                {% if category == "streak" %}
                    var match = "{{ message }}".match(/streak (\d+)/);
                    if (match) {
                        showStreakToast(match[1]);
                    }
                {% endif %}
            {% endfor %}
        {% endwith %}
    });

</script>
{% endblock %}