<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Uƒç se anglicky zdarma a z√°bavnƒõ. Knowix nab√≠z√≠ p√≠sniƒçky, chatov√© lekce, testy, p≈ô√≠bƒõhy a interaktivn√≠ cviƒçen√≠ pro dƒõti i studenty. Modern√≠ v√Ωuka angliƒçtiny bez reklam. Angliƒçitna Zdarma, Z√°bavn√° Angliƒçtina">
    <meta name="keywords" content="angliƒçtina zdarma, v√Ωuka angliƒçtiny, angliƒçtina pro dƒõti, procviƒçov√°n√≠ angliƒçtiny, angliƒçtina online, angliƒçtina z√°bavnƒõ, p√≠sniƒçky angliƒçtina, testy angliƒçtina, chat angliƒçtina, gramatika angliƒçtina, knowix">
    <meta name="robots" content="index, follow">
<meta property="og:title" content="Knowix ‚Äì Angliƒçtina zdarma a z√°bavnƒõ">
<meta property="og:description" content="Procviƒçuj angliƒçtinu pomoc√≠ p√≠sniƒçek, chat≈Ø, p≈ô√≠bƒõh≈Ø a test≈Ø. Kompletnƒõ zdarma, bez reklam.">
<meta property="og:image" content="https://www.knowix.cz/static/og-banner.png">
<meta property="og:url" content="https://www.knowix.cz">
<meta property="og:type" content="website">
    <!-- PWA manifest & theme -->
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#0d1117">
    <!-- iOS PWA podpora -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Knowix">
    <link rel="apple-touch-icon" href="/static/pic/logo1.png">
    <!-- CSRF token pro JS -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <!-- P≈ôedej user_id do JS -->
    <meta name="user-id" content="{{ session.get('user_id') or '' }}">

    <link rel="canonical" href="https://www.knowix.cz">

    <title>{% block title %}knowix{% endblock %}</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/mobile_header.css">

    <!-- Preconnect zrychl√≠ DNS a spojen√≠ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Font naƒçti a≈æ po naƒçten√≠ str√°nky -->
    <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600&display=swap" rel="stylesheet"
          media="print" onload="this.media='all'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@400;600&display=swap" rel="stylesheet">
    </noscript>

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <!-- Google tag (gtag.js) -->
<!--<script async src="https://www.googletagmanager.com/gtag/js?id=G-W1EN990JKP"></script>-->
<!--<script>-->
<!--  window.dataLayer = window.dataLayer || [];-->
<!--  function gtag(){dataLayer.push(arguments);}-->
<!--  gtag('js', new Date());-->

<!--  gtag('config', 'G-W1EN990JKP');-->
<!--</script>-->
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Knowix",
  "url": "https://www.knowix.cz",
  "description": "Z√°bavn√© procviƒçov√°n√≠ angliƒçtiny pomoc√≠ p√≠sniƒçek, chatu a test≈Ø. Knowix je zdarma a bez reklam."
}
</script>
    <style>
        /* Zv√Ωraznƒõn√° tlaƒç√≠tka pro PWA a notifikace */
        .pwa-action-btn {
            display:none; /* z≈Øst√°v√°, JS p≈ôepne na inline-block */
            background: linear-gradient(135deg,#2d7ff9,#6aa9ff);
            color:#fff;
            border:none;
            cursor:pointer;
            padding:6px 14px;
            font-size:14px;
            font-weight:600;
            border-radius:999px;
            font-family:inherit;
            position:relative;
            box-shadow:0 4px 12px rgba(0,0,0,.15);
            transition:background .3s, transform .15s, box-shadow .3s;
        }
        .pwa-action-btn[data-type="notif"] {background: linear-gradient(135deg,#ff9600,#ffbf4d);}
        .dark-mode .pwa-action-btn {box-shadow:0 4px 14px rgba(0,0,0,.5);}
        .pwa-action-btn:hover {transform:translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,.25);}
        .pwa-action-btn:active {transform:translateY(0); box-shadow:0 3px 10px rgba(0,0,0,.2);}
        .pwa-action-btn:focus-visible {outline:2px solid #fff; outline-offset:3px;}
        .pwa-action-btn .icon {margin-right:6px; font-size:16px;}
        .pwa-action-btn .label {vertical-align:middle;}
        /* Pulz p≈ôi prvn√≠m zobrazen√≠ */
        @keyframes pwaPulse {0%{box-shadow:0 0 0 0 rgba(45,127,249,.6);}70%{box-shadow:0 0 0 10px rgba(45,127,249,0);}100%{box-shadow:0 0 0 0 rgba(45,127,249,0);}}
        @keyframes notifPulse {0%{box-shadow:0 0 0 0 rgba(255,150,0,.6);}70%{box-shadow:0 0 0 10px rgba(255,150,0,0);}100%{box-shadow:0 0 0 0 rgba(255,150,0,0);}}
        .pwa-action-btn.pulse {animation:pwaPulse 2s ease-out 1;}
        .pwa-action-btn[data-type="notif"].pulse {animation:notifPulse 2s ease-out 1;}
    </style>
    <style>
    /* Kdy≈æ je onboarding aktivn√≠, rozost≈ôi obsah za n√≠m */
    body.onboarding-active #content-wrapper {
        filter: blur(3px);
        opacity: 0.7;
        pointer-events: none;
        user-select: none;
        transition: filter 0.3s ease, opacity 0.3s ease;
    }

    /* V√Ωjimka pro highlighted element */
    .onboarding-highlight {
        filter: none !important;
        opacity: 1 !important;
        pointer-events: auto !important;
    }
</style>
</head>
<body class="{{ 'dark-mode' if session.get('theme') == 'dark' else '' }}">
<header>
    <div class="logo-streak-wrapper">
        <div class="logo">
            <a href="{{ url_for('main.index') }}">
                <img src="{{ url_for('static', filename='pic/logo.webp') }}" alt="Knowix Logo">
            </a>
        </div>
        <span class="streak-badge">
            <img src="/static/fire.svg" alt="Streak">
            {{ user_streak }}
        </span>
    </div>
    <div class="nav-profile-wrapper">
        <ul class="nav-right">
            <li>
                <a href="/anglictina" title="Angliƒçtina">
                    <img src="{{ url_for('static', filename='icons/eng.png') }}" alt="Angliƒçtina" class="nav-icon">
                </a>
            </li>
<!--            <li>-->
<!--                <a href="/math" title="Matematika">-->
<!--                    <img src="{{ url_for('static', filename='icons/math.png') }}" alt="Angliƒçtina" class="nav-icon">-->
<!--                </a>-->
<!--            </li>-->
            <li>
                <a href="/feedback" title="Feedback">
                    <img src="{{ url_for('static', filename='icons/chat.png') }}" alt="Feedback" class="nav-icon">
                </a>
            </li>
            <li>
                <a href="/news" title="Novinky">
                    <img src="{{ url_for('static', filename='icons/bell.png') }}" alt="Novinky" class="nav-icon">
                </a>
            </li>
            <li>
                <a href="/obchod" title="Obchod">
                    <img src="{{ url_for('static', filename='icons/shop.png') }}" alt="Obchod" class="nav-icon">
                </a>
            </li>
            <li>
                <a href="/zpravy" title="Zpr√°vy">
                    <img src="{{ url_for('static', filename='icons/mail.png') }}" alt="Zpr√°vy" class="nav-icon">
                </a>
            </li>
            <li>
                <button id="theme-toggle" title="P≈ôepnout t√©ma" style="background:none;border:none;cursor:pointer;padding:0;">
                    üåô
                </button>
            </li>
            <li>
                <button id="enable-notifications" data-type="notif" aria-label="Povolit notifikace" title="Povolit notifikace" class="pwa-action-btn" style="display:none;">
                    <span class="icon">üîî</span><span class="label">Notifikace</span>
                </button>
            </li>
            {% if session.user_id == 1 %}
            <li>
    <button id="test-push" title="Test push notifikac√≠" style="background:none;border:1px solid #444;border-radius:6px;cursor:pointer;padding:4px 8px;color:inherit;font-size:12px;">
        Test Push
    </button>
</li>

<li>
    <a href="/push/admin/subscriptions" title="Push Admin" style="color: #ff4444; font-weight: bold;">
        üîß Push Admin
    </a>
</li>
{% endif %}
            <li>
                <button id="install-app" data-type="pwa" aria-label="Instalovat aplikaci" title="Instalovat aplikaci" class="pwa-action-btn" style="display:none;">
                    <span class="icon">‚¨áÔ∏è</span><span class="label">Instalovat</span>
                </button>
            </li>
<!--            <li>-->
<!--                <button id="test-notif" title="Test notifikace" style="background:none;border:1px solid #444;border-radius:6px;cursor:pointer;padding:4px 8px;color:inherit;">Test notif</button>-->
<!--            </li>-->
        </ul>
        {% if session.get('user_name') %}
        <div class="user-profile">
            <div class="profile-container">
                {% if session.get('profile_pic') %}
                <img src="{{ url_for('static', filename='profile_pics/' + session.get('profile_pic')) }}"
                     alt="Profilov√° fotka" width="64" class="profile-pic"
                     onerror="this.onerror=null; this.src='{{ url_for('static', filename='pic/default.webp') }}';">
                {% else %}
                <img src="{{ url_for('static', filename='pic/default.webp') }}" alt="Defaultn√≠ profilovka"
                     class="profile-pic" id="profileMenuTrigger">
                {% endif %}
                <div class="profile-menu" id="profileMenu">
                    <a href="{{ url_for('auth.settings') }}">‚öôÔ∏è Nastaven√≠</a>
                    <a href="{{ url_for('auth.logout') }}">üö™ Odhl√°sit se</a>
                </div>
                <span class="greeting" style="margin-left: 10px;">Ahoj {{ (session.get('user_name') or '').split()[0] }}!</span>
            </div>
            {% if user_xp is defined and user_level is defined and user_level_name is defined and user_progress_percent is defined %}
            <div class="xp-header-bar">
                <div class="xp-header-bar-labels">
                    <span class="xp-level-badge">Level {{ user_level }} ‚Äì {{ user_level_name }}</span>
                    <span class="xp-value">{{ user_xp_in_level }}/50 XP</span>
                </div>
                <div class="xp-header-bar-progress-bg">
                    <div class="xp-header-bar-progress" style="width: {{ user_progress_percent }}%"></div>
                </div>
            </div>
            {% endif %}
        </div>
        {% else %}
<div class="auth-links">
    <a href="{{ url_for('auth.login') }}" class="auth-btn login-btn">üîë P≈ôihl√°sit se</a>
    <a href="{{ url_for('auth.register') }}" class="auth-btn register-btn">üìù Registrovat se</a>
</div>
        {% endif %}
    </div>
</header>
<main>
    {% block content %}{% endblock %}
</main>
<footer>
    <p>&copy; 2025 Knowix. V≈°echna pr√°va vyhrazena.</p>
    <p class="footer-signature">
        Made with ‚ù§Ô∏è by
        <a href="https://ko-fi.com/voku199" target="_blank" style="color: inherit; text-decoration: underline;">Voku</a>
        and lot of ‚òï
    </p>
</footer>
<script src="/static/js/pwa.js"></script>
<script>
// Diagnostika push notifikac√≠
document.getElementById('test-push')?.addEventListener('click', async function() {
    try {
        const response = await fetch('/push/test-send', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.content || ''
            },
            body: JSON.stringify({
                title: 'Test Knowix',
                body: 'Pokud vid√≠≈° tuto zpr√°vu, push notifikace funguj√≠! üéâ',
                url: '/'
            })
        });

        const result = await response.json();
        alert('Test v√Ωsledek:\n' + JSON.stringify(result, null, 2));
    } catch (error) {
        alert('Chyba testu: ' + error.message);
    }
});

// P≈ôep√≠naƒç notifikac√≠: povolit/vypnout (unsubscribe)
(function(){
  const btn = document.getElementById('enable-notifications');
  if (!btn) return;

  // Pomocn√° funkce pro nastaven√≠ vizu√°lu tlaƒç√≠tka
  function setBtnState(enabled){
    if (enabled){
      btn.querySelector('.icon')?.replaceWith(Object.assign(document.createElement('span'), {className:'icon', textContent:'üîî'}));
      btn.querySelector('.label')?.replaceWith(Object.assign(document.createElement('span'), {className:'label', textContent:'Vypnout notifikace'}));
      btn.title = 'Vypnout notifikace';
    } else {
      btn.querySelector('.icon')?.replaceWith(Object.assign(document.createElement('span'), {className:'icon', textContent:'üîî'}));
      btn.querySelector('.label')?.replaceWith(Object.assign(document.createElement('span'), {className:'label', textContent:'Povolit notifikace'}));
      btn.title = 'Povolit notifikace';
    }
  }

  // Inicializace stavu podle subscription
  (async function init(){
    try {
      const reg = await navigator.serviceWorker.ready;
      const sub = await reg.pushManager.getSubscription();
      setBtnState(!!sub && Notification.permission === 'granted');
      btn.style.display = 'inline-block';
    } catch(e){ /* ignore */ }
  })();

  btn.addEventListener('click', async function(){
    try {
      // Pokud prohl√≠≈æeƒç nepodporuje notifikace
      if (!('Notification' in window)){
        alert('Notifikace nejsou podporovan√© t√≠mto prohl√≠≈æeƒçem.');
        return;
      }
      const reg = await navigator.serviceWorker.ready;
      let sub = await reg.pushManager.getSubscription();

      // Pokud je subscription a povolen√≠ udƒõleno -> vypnout (unsubscribe)
      if (sub && Notification.permission === 'granted'){
        const ok = await sub.unsubscribe();
        setBtnState(false);
        if (!ok){
          console.warn('Unsubscribe nevr√°til OK, ale subscription by mƒõla b√Ωt zru≈°ena.');
        }
        alert('Notifikace byly vypnuty.');
        return;
      }

      // Pokud nem√°me subscription, po≈æ√°d√°me o opr√°vnƒõn√≠ a pokus√≠me se p≈ôihl√°sit
      if (Notification.permission === 'default'){
        const perm = await Notification.requestPermission();
        if (perm !== 'granted'){
          alert('Notifikace nejsou povolen√©. Povol je v nastaven√≠ prohl√≠≈æeƒçe.');
          setBtnState(false);
          return;
        }
      } else if (Notification.permission === 'denied'){
        alert('Notifikace jsou zak√°zan√© v prohl√≠≈æeƒçi. Povol je v nastaven√≠.');
        setBtnState(false);
        return;
      }

      // Vytvo≈ôen√≠ nov√© subscription (vy≈æaduje VAPID public key na serveru ‚Äì pokud pwa.js ji≈æ ≈ôe≈°√≠, jen triggeruj)
      try {
        // Pokud va≈°e pwa.js obsahuje logiku pro subscribe, lze ji vyvolat ud√°lost√≠/custom handlerem.
        // Zde fallback: pokus o vytvo≈ôen√≠ subscription bez odesl√°n√≠ na server (nutn√© doplnit VAPID kl√≠ƒç v re√°ln√© implementaci).
        const newSub = await reg.pushManager.subscribe({ userVisibleOnly: true, applicationServerKey: undefined });
        if (newSub){
          setBtnState(true);
          alert('Notifikace byly povoleny.');
        } else {
          alert('Nepoda≈ôilo se povolit notifikace.');
          setBtnState(false);
        }
      } catch(err){
        console.error('Subscribe error', err);
        alert('Chyba p≈ôi povolov√°n√≠ notifikac√≠.');
        setBtnState(false);
      }
    } catch(e){
      console.error('Toggle notif error', e);
      alert('Chyba p≈ôi zmƒõnƒõ stavu notifikac√≠.');
    }
  });
})();

    document.getElementById('theme-toggle').addEventListener('click', () => {
        fetch('/set_theme', {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'X-CSRFToken': CSRF_TOKEN},
            body: JSON.stringify({
                theme: document.body.classList.contains('dark-mode') ? 'light' : 'dark',
                csrf_token: CSRF_TOKEN
            })
        }).then(r => {
            if (r.ok) {
                document.body.classList.toggle('dark-mode');
                sessionStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            }
        });
    });
</script>
<script>
(function(){
  const btn = document.getElementById('test-notif');
  if(!btn) return;
  btn.addEventListener('click', async ()=>{
    try {
      if(Notification.permission === 'default') {
        await Notification.requestPermission();
      }
      if(Notification.permission !== 'granted') {
        alert('Notifikace nejsou povoleny v prohl√≠≈æeƒçi/OS.');
        return;
      }
      const reg = await navigator.serviceWorker.ready;
      // Preferuj PNG (Windows/Chrome ƒçasto l√©pe zobraz√≠)
      const iconPng = '/static/icons/bell.png';
      await reg.showNotification('Test notifikace ‚Äì Knowix', {
        body: 'Pokud vid√≠≈° tento toast, notifikace funguj√≠. (klikni pro otev≈ôen√≠ dom≈Ø)',
        icon: iconPng,
        badge: iconPng,
        requireInteraction: true,
        renotify: true,
        tag: 'knowix-test-1',
        vibrate: [100, 50, 100],
        data: { url: '/' }
      });
      // Fallback pro nƒõkter√° prost≈ôed√≠ ‚Äì vytvo≈ô√≠ i ne-persistentn√≠ notifikaci
      try { new Notification('Fallback notif', { body: 'Alternativn√≠ zp≈Øsob zobrazen√≠', icon: iconPng, tag: 'knowix-fallback-1', requireInteraction: true }); } catch(_){ }
    } catch(e){ console.error('Test notifikace selhal', e); alert('Zobrazen√≠ notifikace selhalo ‚Äì viz konzoli.'); }
  });
})();
</script>
<script>
// P≈ôid√°n√≠ pulzu po zobrazen√≠ tlaƒç√≠tek (pozoruje zmƒõnu display)
(function(){
  const notifBtn = document.getElementById('enable-notifications');
  const installBtn = document.getElementById('install-app');
  const observer = new MutationObserver(muts => {
    muts.forEach(m => {
      if (m.attributeName === 'style') {
        if (installBtn && installBtn.style.display !== 'none' && !installBtn.classList.contains('pulse')) {
          installBtn.classList.add('pulse');
        }
        if (notifBtn && notifBtn.style.display !== 'none' && !notifBtn.classList.contains('pulse')) {
          notifBtn.classList.add('pulse');
        }
      }
    });
  });
  if (installBtn) observer.observe(installBtn, {attributes:true});
  if (notifBtn) observer.observe(notifBtn, {attributes:true});
})();
</script>

{# Onboarding overlay ‚Äì vlo≈æeno glob√°lnƒõ #}
{% include 'onboarding.html' %}

</body>
</html>
